version: '3.8'
services:
#  db:
#    restart: always
#    image: mysql
#    command: --default-authentication-plugin=mysql_native_password
#    environment:
#      MYSQL_ROOT_PASSWORD: 24956501
#    ports:
#      - 3306:3306
#    volumes:
#      - ./docker/database/data:/var/lib/mysql
#      - ./docker/database/config:/etc/mysql/conf.d
#  redis:
#      restart: always
#      image: redis
#      container_name: redis
#      command: redis-server --requirepass yunmai365
#      ports:
#        - 6379:6379
  nginx:
      restart: always
      image: nginx
      ports:
        - 80:80
        - 443:443
      volumes:
        - ./docker/proxy:/etc/nginx/pixiv/
        - ./docker/proxy/ca:/etc/nginx/ca/
        - ./docker/proxy/nginx.conf:/etc/nginx/nginx.conf
      networks:
        app_net:
          ipv4_address: 172.16.238.10

  scrapy:
      tty: true
      build:
        context: ./docker
        dockerfile: python
      volumes:
        - ./space:/data/space
        - .:/app
        - ./docker/scrapy/ca-certificates:/usr/local/share/ca-certificates
        - ./docker/scrapy/hosts:/etc/hosts
      networks:
        app_net:
          ipv4_address: 172.16.238.20
      command: tail -f /dev/null
networks:
  app_net:
    ipam:
      driver: default
      config:
        - subnet: "172.16.238.0/24"